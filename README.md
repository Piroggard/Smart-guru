# Теория

## Статический анализ кода
Это надёжный способ, как защитить кодовую базу и добиться полного соблюдения всех принятых стандартов и соглашений.
Если код плохо написан, если он плохо структурирован или плохо отформатирован, то его будет сложно читать.
Сложно — значит долго. Разработчики будут тратить лишнее время на работу с таким кодом,
что в свою очередь будет снижать скорость вывода новых возможностей на рынок, а значит и качество итогового продукта.

При внедрении статического анализа на проекте ни в коем случае не забывайте про элементарную психологию.
Какие бы классные ребята с вами не работали, они в первую очередь люди, а большинство людей негативно воспринимает нововведения;
особенно те, которые их как-то ограничивают. Дайте вашей команде привыкнуть. Внедряйте проверки постепенно, демонстрируя их полезность
(начинайте с небольшого количества проверок; подбирайте их под ваш проект и стиль,
постепенно добавляя новые проверки, до тех пор, пока не попробуете все).
И помните: негативная реакция и естественное сопротивление команды не должны вас ни в коем случае останавливать.

## Checkstyle и EditorConfig

Статический анализатор кода Checkstyle позволяет зафиксировать и отслеживать во время сборки проекта соответствие кода принятым стандартам оформления.
Больше не будет споров по типу: табуляция или пробелы; 2 или 4 пробела для отступа и т.д. За этим будет следить Checkstyle.
Чтобы разработчикам было проще следовать стандартам оформления кода, необходимо в каждом проекте иметь сконфигурированный файл EditorConfig.
Современные IDE умеют его подтягивать и брать из него настройки.

## Скрипты Git hook

Хук Git — это скрипт, который автоматически запускается каждый раз, когда в репозитории Git происходит определенное событие.
С помощью хуков можно конфигурировать внутреннее поведение Git и запускать настраиваемые действия в ключевые моменты жизненного цикла разработки.

Хуки находятся в каталоге .git/hooks каждого репозитория Git. Система Git автоматически заполняет этот каталог образцами скриптов при инициализации репозитория.
В .git/hooks можно найти следующие файлы:

- applypatch-msg.sample
- commit-msg.sample
- post-update.sample
- pre-applypatch.sample
- pre-commit.sample
- prepare-commit-msg.sample
- pre-push.sample
- pre-rebase.sample
- update.sample и так далее

из-за расширения .sample они не исполняются по умолчанию. Чтобы «установить» хук, достаточно удалить расширение .sample.
Кроме того, самостоятельно написав новый скрипт, вы сможете быстро добавить новый файл с одним из перечисленных выше имен и без расширения .sample.

Поддерживать базу хуков для команды разработчиков может быть непросто, потому что каталог .git/hooks не клонируется вместе с проектом и не подпадает под контроль версий.
Проблему легко устранить, если сохранить хуки непосредственно в каталоге проекта (над каталогом .git). Это позволит редактировать хуки так же, как и любой файл в системе управления версиями.
Чтобы установить хук, можно просто копировать и вставлять хук в каталог .git/hooks при каждом обновлении хука.

Все описанные ниже локальные хуки может изменить или полностью удалить владелец репозитория.
Каждый участник команды сам решает, использовать ли ему тот или иной хук.
Об этом стоит помнить и относиться к хукам как к удобному инструменту разработки, а не как к обязательным правилам.

## pre-commit

Скрипт pre-commit исполняется при каждом выполнении команды git commit, перед тем как Git запросит ввод комментария к коммиту или создаст объект коммита.
Этот хук можно использовать для проверки отправляемого снимка состояния.
К примеру, он позволяет запустить автоматическое тестирование и проверить, не нарушит ли коммит работу существующих функций.

Скрипт pre-commit не принимает аргументов, а ненулевое состояние выхода приведет к отмене всего коммита.
Внутри pre-commit можно выполнять различные действия, в том числе запускать другие скрипты и сторонние наборы тестов, а также проверять стиль кода с помощью Lint.

# Практика
1. Проверим работу статического анализатора кода Checkstyle

#### Выполним первую команду в терминале:
```
mvn checkstyle:check -fae
```

2. Необходимо настроить в операционной системе отображение скрытых папок: Показывать скрытые файлы, папки:
  * Нажмите кнопку "Пуск" и выберите пункты Панель управления > Оформление и персонализация.
  * Выберите Параметры папок, а затем откройте вкладку Вид.
  * В разделе Дополнительные параметры выберите Показывать скрытые файлы, папки и диски, а затем нажмите кнопку ОК.
3. В папке проекта появится папка .git
4. Окрыть папку .git > hooks и добавить 2 файла: pre-commit и pre-commit.ps1 (расположены в папке config > git)
5. Проверим, что предыдущие шаги правильны:

#### Выполним вторую команду в терминале, делаем pre-commit исполняемым:
```
chmod +x .git/hooks/pre-commit
```

#### Выполним третью команду в терминале, запускаем файл pre-commit.ps1:
```
powershell.exe -ExecutionPolicy Bypass -File "$(pwd)/.git/hooks/pre-commit.ps1"
```

#### Выполним четвертую команду в терминале, запускаем файл pre-commit:

```
.git/hooks/pre-commit
```

6. Можно внести какие-либо тестовые изменения в проект (например комментрий)
7. Добавляем изменения в индекс:

#### Выполним пятую команду в терминале (путь к файлу должен быть собственным):

```
git add src/main/java/ru/albert/springliquibase/SpringLiquibaseApplication.java
```

8. Выпоняем коммит

#### Выполним шестую команду в терминале:

```
git commit -m "Test pre-commit hook"
```

Дойдя до этого пункта мы убедились, что все работает с помощью команд прописанных в терминале.

Финальная проверка: 
* сделать изменения в проекте
* классически в среде перейти в раздел Commit
* выбрать файлы
* добавить комментарий
* нажать кнопку Commit


## Файл .editorconfig

Ошибок может быть очень много, сотни или тысячи. Вручную исправлять долго. Можно попросить среду разработки отформатировать файлы на основе набора правил прописанных в конфигурационном файле редактора.

В среде разработки включаем поддержку конфигурации редактора:
File > Settings > Editor > Code Style > Enable EditorConfig support (ставим галку).

После щелкаем пкм по папке содержимое которой хотим отформатировать > Reformat Code > Include subdirectories (ставим галку) и Optimize imports (ставим галку) > нажимаем Run.

Программа автоматически поправит файлы содержащиеся в данной папке согласно набора правил прописанных в конфигурационном файле редактора.

## Ссылки на литературу

- [Статический анализ кода](https://habr.com/ru/articles/680018/)
- [Скрипты Git hook](https://www.atlassian.com/ru/git/tutorials/git-hooks)
- [Видео, смотрите в Яндекс браузере с переводчиком](https://www.youtube.com/watch?v=mvI9d8rH4IY&t=395s)
